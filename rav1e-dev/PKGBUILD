pkgname=rav1e-dev
pkgver=0.6.3
pkgrel=1
pkgdesc='The fastest and safest AV1 encoder'
arch=('x86_64')
url="https://github.com/xiph/rav1e/"
license=('spdx:BSD-2-Clause')
source=("git+https://github.com/xiph/rav1e.git")
md5sums=('SKIP')

package() {
  export PATH="${TOP_DIR}/cross/bin:${TOP_DIR}/rustup/.cargo/bin:$PATH"
  export PKG_CONFIG_LIBDIR="${MINGW_PREFIX}/lib/pkgconfig"
  export PKG_CONFIG="pkgconf --static"
  export RUSTUP_HOME="${TOP_DIR}/rustup/.rustup"
  export CARGO_HOME="${TOP_DIR}/rustup/.cargo"
  cd $srcdir/rav1e
  mkdir build
  export CARGO_BUILD_TARGET_DIR=build
  export CARGO_PROFILE_RELEASE_CODEGEN_UNITS=1
  export CARGO_PROFILE_RELEASE_DEBUG=false
  export CARGO_PROFILE_RELEASE_INCREMENTAL=false
  export CARGO_PROFILE_RELEASE_LTO=off
  cargo cinstall --manifest-path=Cargo.toml --prefix=${MINGW_PREFIX} --destdir=$pkgdir --release --target x86_64-pc-windows-gnu --crt-static --library-type staticlib
}
