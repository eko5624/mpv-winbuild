pkgname=libbluray-dev
pkgver=1.4.0
pkgrel=1
pkgdesc='Library to access Blu-Ray disks for video playback'
arch=('x86_64')
url="https://www.videolan.org/developers/libbluray.html"
makedepends=('freetype2-dev' 'libpng-dev' 'libudfread-dev' 'zlib-dev')
license=('GPL')
source=("git+https://code.videolan.org/videolan/libbluray.git")
md5sums=('SKIP')

build() {
  cd $srcdir/libbluray
  sed -i '/find_library/d' meson.build
  NO_CONFLTO=1 meson setup build \
    --prefix="${MINGW_PREFIX}" \
    --libdir=${MINGW_PREFIX}/lib \
    --cross-file=../../../cross.meson \
    --buildtype=release \
    --default-library=static \
    -Denable_tools=false \
    -Dbdj_jar=disabled \
    -Djava9=false \
    -Dfreetype=enabled \
    -Dlibxml2=enabled \
    -Dc_args="-Ddec_init=libbluray_dec_init"
  meson compile -C build
}

package() {
  cd $srcdir/libbluray
  DESTDIR=$pkgdir meson install -C build
  sed -i 's/-lbluray/-lbluray -lgdi32/' $pkgdir${MINGW_PREFIX}/lib/pkgconfig/*.pc
}
