pkgname=libzimg-dev
pkgver=3.0.5
pkgrel=1
pkgdesc='Scaling, colorspace conversion, and dithering library'
arch=('x86_64')
url="https://github.com/sekrit-twc/"
license=('LGPL')
source=("git+https://github.com/sekrit-twc/zimg.git"
        "git+https://github.com/sekrit-twc/graphengine.git"
        "0001-libm_wrapper-define.patch")
md5sums=('SKIP' 'SKIP' 'SKIP')

build() {
  export PATH="${TOP_DIR}/cross/bin:$PATH"
  export PKG_CONFIG_LIBDIR="${MINGW_PREFIX}/lib/pkgconfig"
  export PKG_CONFIG="pkgconf --static"
  cd $srcdir/zimg
  rm -rf graphengine 
  mv $srcdir/graphengine ./
  #patch -p1 -i $srcdir/0001-libm_wrapper-define.patch
  ./autogen.sh
  ./configure \
    --host=${TARGET_ARCH} \
    --prefix=${MINGW_PREFIX} \
    --disable-shared \
    --enable-static
  make 
}

package() {
  cd $srcdir/zimg
  make DESTDIR=$pkgdir install
}
