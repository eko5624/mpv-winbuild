pkgname=libdovi-dev
pkgver=3.3.1
pkgrel=1
pkgdesc='Library to read and write Dolby Vision metadata (C-API)'
arch=('x86_64')
url="https://github.com/quietvoid/dovi_tool/"
license=('MIT')
source=("git+https://github.com/quietvoid/dovi_tool.git#commit=108f7892fa9c5c5b24caec29f2289cf805e52119")
md5sums=('SKIP')

package() {
  cd $srcdir/dovi_tool/dolby_vision
  mkdir build
  export LD_PRELOAD=""
  export CARGO_BUILD_TARGET_DIR=build
  export CARGO_PROFILE_RELEASE_CODEGEN_UNITS=1
  eval "$RUST_LTO"
  rustup target add x86_64-pc-windows-gnu
  cargo update -p bitvec_helpers --precise 3.1.3
  cargo update -p bitstream-io --precise 2.2.0  
  cargo update -p anyhow --precise 1.0.81
  cargo update -p bitvec --precise 1.0.1
  cargo update -p funty --precise 2.0.0
  cargo update -p crc --precise 3.0.1
  cargo update -p serde --precise 1.0.197
  cargo update -p serde_json --precise 1.0.114
  cargo update -p roxmltree --precise 0.19.0

  cargo cinstall --manifest-path=Cargo.toml --prefix=${MINGW_PREFIX} --destdir=$pkgdir --target=x86_64-pc-windows-gnu --release --library-type staticlib
}
